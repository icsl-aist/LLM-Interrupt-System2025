# LLM-Interrupt-System2025
## プロジェクト名

山本研究室（知的制御研究室）LLMチーム2026卒業研究制作物

## ファイル構成

### Python スクリプト (実行・制御系)
| ファイル名 | 説明 |
|------------|------|
| `manager.py` | **【操作用】** ユーザーがコマンドを入力し、ロボットへ指令を送る送信機プログラム |
| `robots_client.py` | **【ロボット用】** ロボット側で動作し、指令を受け取ってタスクを実行する受信機プログラム |
| `robot_api_manager.py` | KachakaとAkariの接続・初期化を管理するプログラム (シングルトン管理) |
| `config.py` | システム全体の設定ファイル（IPアドレス、APIキー設定、パス設定など） |

### Python スクリプト (LLM・生成系)
| ファイル名 | 説明 |
|------------|------|
| `LLM_manager.py` | OpenAI APIとの通信、トークン計算、ログ保存を行う共通モジュール |
| `task_generate.py` | ユーザーの指示から「ロボットの行動計画（Pythonコード）」を生成するスクリプト |
| `talk_generate.py` | 行動計画に基づいて「ロボットの会話内容」を生成するスクリプト |

### ロボット制御関数群 (`_robot_function/`)
| ファイル名 | 説明 |
|------------|------|
| `function_list_kachaka.py` | Kachakaの機能（移動、棚運び、発話、各種ガード処理）を定義したクラス |
| `function_list_akari.py` | Akariの機能（M5Stack表情、首振り、発話、MQTT連携）を定義したクラス |

### その他
| ファイル名 | 説明 |
|------------|------|
| `requirements.txt` | 必要なPythonライブラリの一覧 |
| `_robot_programs/` | LLMによって自動生成されたスクリプトが保存されるフォルダ |
| `_LLM/log/` | 生成ログやトークン使用量が記録されるフォルダ |
| `README.md` | このファイル |

---

## 主要スクリプトの詳細説明

### 1. `manager.py` (指令用)
ユーザーがPCのターミナルからロボットに命令を送るためのインターフェースです。
MQTTブローカーを介して `robots_client.py` と通信します。

**主なコマンド:**
- `order <指示内容>` : LLMに行動生成を依頼します (例: `order リビングからお菓子を持ってきて`)
- `stop` : 全ロボットを緊急停止します
- `kachaka <コマンド>` : Kachakaの特定機能を直接実行します
- `akari <コマンド>` : Akariの特定機能を直接実行します

### 2. `robots_client.py` (実行用)
ロボットを制御するPC上で常駐させるメインプログラムです。
`manager.py` からの指令を待ち受け、以下の処理を行います。
1. **LLM生成**: 指示を受け取ると `task_generate.py` `talk_generate.py` を呼び出してコードを生成
2. **動的実行**: 生成されたPythonコードを読み込み、ロボット実機を制御してタスクを実行
3. **割り込み制御**: 実行中のタスクに対して、停止(STOP)や一時停止(PAUSE)を受け付ける

---

## 使用方法

このプロジェクトを実行するには、以下の環境が必要です。

### 必要な環境
- Python 3.10 以上推奨
- **OpenAI API Key** (GPT-4o利用のため)
- **MQTTブローカー** (Mosquitto等がローカルまたはサーバーで稼働していること)
- `requirements.txt` に記載されたPythonライブラリ

### セットアップ手順

1. **ライブラリのインストール**
   ```bash
   pip install -r requirements.txt
