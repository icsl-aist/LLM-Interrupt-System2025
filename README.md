# LLM-Interrupt-System2025
## プロジェクト名

山本研究室（知的制御研究室）LLMチーム2026卒業研究制作物

## ディレクトリ構成

### 📂 ルートディレクトリ (実行・設定)
システムを実行するためのメインスクリプトと設定ファイルです。

| ファイル名 | 説明 |
|------------|------|
| `manager.py` | **【操作用】** ユーザーがコマンドを入力し、ロボットへ指令を送る送信機プログラム |
| `robots_client.py` | **【ロボット用】** ロボット側で動作し、指令を受け取ってタスクを実行する受信機プログラム |
| `config.py` | IPアドレス、APIキー、ファイルパスなどのシステム全体設定 |
| `robot_api_manager.py` | KachakaとAkariの接続・初期化を管理するシングルトンクラス |
| `requirements.txt` | 必要なPythonライブラリの一覧 |

### 📂 `_LLM/` (生成ロジック・プロンプト)
LLM（ChatGPT）との通信や、プロンプト管理を行うモジュール群です。

| ファイル名 | 説明 |
|------------|------|
| `LLM_manager.py` | OpenAI API通信、ログ保存、トークン計算を行う共通機能 |
| `task_generate.py` | ユーザー指示から「行動計画（Pythonコード）」を生成するスクリプト |
| `talk_generate.py` | 行動計画に基づき「ロボットの発話内容」を生成するスクリプト |
| `prompt/` | プロンプト定義ファイル（JSON/TXT）が格納されるフォルダ |
| `log/` | 生成ログやトークン使用量 (`token_log.txt` 等) の保存先 |

### 📂 `_robot_function/` (ロボット制御定義)
各ロボットの具体的な動作メソッドを定義したライブラリです。

| ファイル名 | 説明 |
|------------|------|
| `function_list_kachaka.py` | Kachaka用機能（移動、棚運び、発話、ガード処理） |
| `function_list_akari.py` | Akari用機能（M5Stack表情、首振り、発話） |

### 📂 `_robot_programs/` (生成コード保存先)
LLMによって自動生成されたスクリプトが保存されます。

| ファイル名 | 説明 |
|------------|------|
| `llm_task.txt` | 一時的に生成された行動計画スクリプト |
| `llm_final.txt` | 会話文が付与された、最終的に実行されるスクリプト |

---

## 主要スクリプトの詳細

### 1. `manager.py` (指令用)
ユーザーがPCのターミナルからロボットに命令を送るためのインターフェースです。
MQTTブローカーを介して `robots_client.py` と通信します。

**主なコマンド:**
- `order <指示内容>` : LLMに行動生成を依頼します (例: `order リビングからお菓子を持ってきて`)
- `stop` : 全ロボットを緊急停止します
- `kachaka <コマンド>` : Kachakaの特定機能を直接実行します
- `akari <コマンド>` : Akariの特定機能を直接実行します

### 2. `robots_client.py` (実行用)
ロボットを制御するPC上で常駐させるメインプログラムです。
`manager.py` からの指令を待ち受け、以下の処理を行います。
1. **LLM生成**: `_LLM/` 内のモジュールを呼び出し、タスクと会話を生成
2. **動的実行**: `_robot_programs/llm_final.txt` を読み込み、ロボット実機を制御
3. **割り込み制御**: 実行中のタスクに対して、停止(STOP)や一時停止(PAUSE)を受け付ける

---

## 使用方法

このプロジェクトを実行するには、以下の環境が必要です。

### 必要な環境
- Python 3.10 以上推奨
- **OpenAI API Key** (GPT-4o利用のため)
- **MQTTブローカー** (Mosquitto等がローカルまたはサーバーで稼働していること)
- `requirements.txt` に記載されたPythonライブラリ

### セットアップ手順

1. **ライブラリのインストール**
   ```bash
   pip install -r requirements.txt
